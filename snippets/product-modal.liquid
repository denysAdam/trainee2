<div>
  <div class="swiper-container px-4">
    <div class="swiper-wrapper">
      {% for product in collections.all.products %}
      <div class="swiper-slide p-4" id="product-{{ product.id }}">
        <div class="product-image mb-4 relative">
          <img id="product-image-{{ product.id }}" class="w-auto h-auto cursor-pointer" src="{{ product.featured_image | image_url: width: 300, height: 300 }}" alt="{{ product.title }}" onclick="openModal('{{ product.id }}')">
          <button class="bg-[#CB8A3D] font-bold text-white rounded-full w-12 h-12 flex items-center justify-center absolute bottom-2 -right-6" onclick="openModal('{{ product.id }}')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
            </svg>
          </button>
        </div>

        <div class="product-info">
          <h2 class="text-xl text-center font-semibold">{{ product.title }}</h2>
          <p class="text-gray-700 text-center font-bold">{{ product.price | money }}</p>
            {% if section.settings.show_reviews %}
          <div class="flex items-center justify-center space-x-2">
            {% assign rating = product.reviews.rating | default: 0 %}
            {% assign reviews_count = product.reviews.count | default: 0 %}
            <div class="flex">
              {% for i in (1..5) %}
              {% if i <= rating %}
              <svg class="w-4 h-4 text-yellow-500 fill-current" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                <path d="M10 15l-5.878 3.09 1.123-6.545-4.762-4.635 6.582-.957L10 .458l2.935 5.495 6.582.957-4.762 4.635 1.123 6.545z" />
              </svg>
              {% else %}
              <svg class="w-4 h-4 text-gray-300 fill-current" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                <path d="M10 15l-5.878 3.09 1.123-6.545-4.762-4.635 6.582-.957L10 .458l2.935 5.495 6.582.957-4.762 4.635 1.123 6.545z" />
              </svg>
              {% endif %}
              {% endfor %}
            </div>
            {% if reviews_count > 0 %}
            <span class="text-xs text-gray-500">({{ reviews_count }} reviews)</span>
            {% else %}
            <span class="text-xs text-gray-500">(No reviews)</span>
            {% endif %}
          </div>
          {% endif %}
        </div>
        <div class="product-variants mt-4">
          <div class="flex space-x-2 justify-center">
            {% for variant in product.variants %}
            <label class="variant-label cursor-pointer">
              <input type="radio" name="product_{{ product.id }}_variant" class="hidden variant-radio" data-variant-id="{{ variant.id }}" data-image-url="{% if variant.image %}{{ variant.image | image_url: width: 300, height: 300 }}{% else %}{{ product.featured_image | image_url: width: 300, height: 300 }}{% endif %}" onclick="selectVariant(this, {{ product.id }})" />
              <span class="h-6 w-6 inline-block rounded-full border border-gray-200" style="background-color: {{ variant.option1 }}" title="{{ variant.title }}"></span>
            </label>
            {% endfor %}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    <div class="swiper-pagination pb-6"></div>
  </div>

  <!-- Модальное окно (по умолчанию скрыто) -->
  <div id="productModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
    <div class="bg-white p-6 rounded-lg max-w-lg w-full relative">
      <button onclick="closeModal()" class="absolute top-2 right-2 text-gray-500">&times;</button>
      <div class="flex">
        <div class="product-image mb-4 relative">
          <img id="modal-product-image" class="w-auto h-auto" src="" alt="Product Image">
        </div>
        <div class="ml-6">
          <h2 id="modal-product-title" class="text-2xl font-bold"></h2>
          <p id="modal-product-price" class="text-gray-700 text-lg font-bold mt-2"></p>
          <div class="mt-4">
            <h3 class="font-semibold">Select Model:</h3>
            <div class="flex space-x-2 mt-2" id="modal-product-models">
              <!-- Динамически добавляются кнопки для выбора модели -->
            </div>
          </div>
          <div class="mt-4">
            <h3 class="font-semibold">Select color:</h3>
            <div class="product-variants mt-4" id="modal-product-colors">
              <!-- Динамически добавляются варианты цветов -->
            </div>
          </div>
          <button class="mt-6 w-full bg-[#CB8A3D] text-white py-2 rounded-lg font-bold">Add to Cart</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    function openModal(productId) {
      const product = document.querySelector(`#product-${productId}`);
      const productImage = product.querySelector('img').src;
      const productTitle = product.querySelector('h2').textContent;
      const productPrice = product.querySelector('p').textContent;
      const modalImage = document.getElementById('modal-product-image');
      const modalTitle = document.getElementById('modal-product-title');
      const modalPrice = document.getElementById('modal-product-price');

      // Устанавливаем данные продукта в модальное окно
      modalImage.src = productImage;
      modalTitle.textContent = productTitle;
      modalPrice.textContent = productPrice;

      // Открываем модальное окно
      document.getElementById('productModal').classList.remove('hidden');
    }

    function closeModal() {
      document.getElementById('productModal').classList.add('hidden');
    }
  </script>
</div>
